angular.module("chute",["ngResource"]),angular.module("chute").constant("apiUrl","http://api.getchute.com/v2"),angular.module("chute").factory("Chute.API.Album",["Chute.API.Resource","$http","apiUrl",function(a,b,c){"use strict";var d=new a(c+"/albums/:collectionRoute:id:shortcut/:memberRoute",{id:"@id",shortcut:"@shortcut",collectionRoute:"@collectionRoute",memberRoute:"@memberRoute"},{});return d.__query=d.query,d.query=function(a,b,c){return d.__query(a,b,c)},d.__get=d.get,d.get=function(a,b,c){return d.__get(a,b,c)},d}]),angular.module("chute").factory("Chute.API.Asset",["Chute.API.Resource","$http","apiUrl","Chute.API.Heart",function(a,b,c,d){"use strict";var e=new a(c+"/albums/:album/assets/:collectionRoute:id/:memberRoute",{album:"@album",id:"@id",collectionRoute:"@collectionRoute",memberRoute:"@memberRoute"},{query:{method:"GET",isArray:!1}}),f=5;return e.Collection={prevPage:function(a,b){this.params.page--;var c=angular.copy(this.params);if(this.params.sort&&"id"!==this.params.sort&&"time"!==this.params.sort){if(this.params.page<=0)throw new RangeError("Cannot fetch previous page with index "+this.params.page+".")}else c.since_id=this[0].chute_asset_id,delete c.page;var d=this;e._query(c,function(b){var f=angular.extend([],{params:angular.copy(d.params)},e.Collection);b&&b.data&&(angular.forEach(b.data,function(a){a.album=c.album;var b=new e(a);f.push(b)}),d.unshift.apply(d,f)),(a||angular.noop)(f,b.headers)},b)},nextPage:function(a,b){this.params.page++;var c=angular.copy(this.params);this.params.sort&&"id"!==this.params.sort&&"time"!==this.params.sort||(c.max_id=this[this.length-1].chute_asset_id,delete c.page);var d=this;e._query(c,function(b){var g=angular.extend([],{params:angular.copy(d.params)},e.Collection);b&&b.data&&(angular.forEach(b.data,function(a){a.album=c.album;var b=new e(a);g.push(b)}),d.push.apply(d,g)),b&&b.data&&b.data.length===(c.per_page||f)||(d._hasMore=!1),(a||angular.noop)(g,b.headers)},b)},hasMore:function(){return!!this._hasMore}},e.__query=e.query,e.query=function(a,b,c){return a.album_id&&(a.album=a.album||a.album_id,delete a.album_id),a.album_shortcut&&(a.album=a.album||a.album_shortcut,delete a.album_shortcut),e.__query(a,function(c,d){angular.forEach(c,function(b){b.album=a.album}),(b||angular.noop)(c,d)},c)},e.__get=e.get,e.get=function(a,b,c){return a.album_id&&(a.album=a.album||a.album_id,delete a.album_id),a.album_shortcut&&(a.album=a.album||a.album_shortcut,delete a.album_shortcut),a.asset&&(a.id=a.id||a.asset,delete a.asset),a.shortcut&&(a.id=a.id||a.shortcut,delete a.shortcut),e.__get(a,b,c)},e.prototype.heart=function(a){a=a||{};var e=this.album+"-"+this.shortcut+"-heart",f=window.localStorage[e];if(f)return(a.error||angular.noop)(),!1;var g=this;b.post(c+"/albums/"+this.album+"/assets/"+this.shortcut+"/hearts").success(function(b){var c=new d(b.data);window.localStorage[e]=c.identifier,g.hearts=(parseInt(g.hearts,10)||0)+1,(a.success||angular.noop)(c)}).error(a.error||angular.noop)},e.prototype.unheart=function(a){a=a||{};var b=this.album+"-"+this.shortcut+"-heart",c=window.localStorage[b];if(!c)return(a.error||angular.noop)(),!1;var e=this;new d({identifier:c}).$remove({},function(c){delete window.localStorage[b],e.hearts=(parseInt(e.hearts,10)||0)-1,(a.success||angular.noop)(c.data)},a.error||angular.noop)},e.prototype.hearted=function(){return!!window.localStorage[this.album+"-"+this.shortcut+"-heart"]},e.prototype.toggleHeart=function(a){this.hearted()?this.unheart(a):this.heart(a)},e}]),angular.module("chute").factory("Chute.API.Heart",["$resource","$http","apiUrl",function(a,b,c){"use strict";var d=a(c+"/hearts/:collectionRoute:id/:memberRoute",{id:"@id",collectionRoute:"@collectionRoute",memberRoute:"@memberRoute"},{});return d.prototype.$remove=d.prototype.$delete=function(a,d,e){d=d||angular.noop,e=e||angular.noop,b["delete"](c+"/hearts/"+this.identifier).success(d).error(e)},d}]),angular.module("chute").factory("Chute.API.Resource",["$resource",function(a){"use strict";var b=function(b,c,d){b=b||"",c=c||{},d=angular.extend(d||{},{query:{method:"GET",isArray:!1}});var e=a(b,c,d),f=5;return e.Collection={prevPage:function(a,b){this.params.page--;var c=angular.copy(this.params);if(this.params.page<=0)throw new RangeError("Cannot fetch previous page with index "+this.params.page+".");var d=this;e._query(c,function(b){var c=angular.extend([],{params:angular.copy(d.params)},e.Collection);b&&b.data&&(angular.forEach(b.data,function(a){c.push(new e(a))}),d.unshift.apply(d,c)),(a||angular.noop)(c,b.headers)},b)},nextPage:function(a,b){this.params.page++;var c=angular.copy(this.params),d=this;e._query(c,function(b){var g=angular.extend([],{params:angular.copy(d.params)},e.Collection);b&&b.data&&(angular.forEach(b.data,function(a){g.push(new e(a))}),d.push.apply(d,g)),b&&b.data&&b.data.length===(c.per_page||f)||(d._hasMore=!1),(a||angular.noop)(g,b.headers)},b)},hasMore:function(){return!!this._hasMore}},e._query=e.query,e.query=function(a,b,c){a=a||{},a.perPage&&(a.per_page=a.perPage,delete a.perPage);var d=angular.extend({page:1},a),g=angular.extend([],{params:d},e.Collection);return e._query(a,function(c){c&&c.data&&(g.length=0,angular.forEach(c.data,function(a){g.push(new e(a))}),g._hasMore=c.data.length<(a.per_page||f)||!c.pagination||!c.pagination.next_page?!1:!0),(b||angular.noop)(g,c.headers)},c),g},e._get=e.get,e.get=function(a,b,c){b=b||angular.noop,c=c||angular.noop;var d={},f=this instanceof e?this:new e(d);return e._get(a,function(a){angular.copy(a.data,f),b(a.data,a.headers)},c),f},e};return b}]);